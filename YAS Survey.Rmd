---
title: "R Notebook"
output: html_notebook
---

# Young Adult Survey

## Statewide Analysis

```{r}
#install.packages("dplyr")
#install.packages("ggplot2")
#install.packages("survey")
#install.packages("haven")
#install.packages("car")
#install.packages("magrittr")
#library(car)
library(haven)
library(ggplot2)
library(survey)
library(dplyr)
library(magrittr)


Wyoming_YAS_2022 <- read.csv("~/Downloads/Wyoming_YAS_2022.csv")
   #View(Wyoming_YAS_2022)
   

#Formatting County
county_lookup_table <- data.frame (
  county_number = c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 
             18, 19, 20, 21, 22, 23),
  county_name = c("Albany", "Big Horn", "Campbell", "Carbon", "Converse", 
                  "Crook", "Fremont", "Goshen", "Hot Springs", "Johnson", 
                  "Laramie", "Lincoln", "Natrona", "Niobrara", "Park", 
                  "Platte", "Sheridan", "Sublette", "Sweetwater", "Teton", 
                  "Uinta", "Washakie", "Weston")
 )

YAS_merge1 <- merge(Wyoming_YAS_2022, county_lookup_table, by.x = "county", by.y = "county_number", all.x=TRUE)

lapply(YAS_merge1[,c("demo", "demo_1___1", "demo_1___2", "demo_1___3", "demo_1___4", "demo_1___5", "demo_1___6", "demo_1___7", "demo_1___8", "demo_1___9", "demo_1___10")], function(x) table(x))


#Recoding different tobacco products
tobrec = paste(colnames(YAS_merge1[,c("t___a", "t___b", "t___c", "t___d", 
                                      "t___e", "t___f", "t___g")]), "_2", 
               sep = "")
YAS_merge1[tobrec] = lapply(YAS_merge1[,c("t___a", "t___b", "t___c", "t___d", "t___e", "t___f", "t___g")], function(x) ifelse(x == 0, 0, ifelse(x == 1, 100, NA)))
lapply(YAS_merge1[,colnames(YAS_merge1) %in% tobrec], function(x) table(x)) 


# create composite variable for any tobacco use
YAS_merge1$ctobany = apply(YAS_merge1[,c("t___a", "t___b", "t___c", "t___d", "t___e", "t___f")], 1, function(x) ifelse(all(is.na(x)), NA,                                                           ifelse(any(x == 1, na.rm = T), 100, 0)))
table(YAS_merge1$ctobany) 
table(YAS_merge1$tobacco_yn) 



```

There are 4,531 survey respondents and 144 variables.

##Weighted Survey Analysis

```{r}
#Creating new variables to include them in the survey analysis

#Creating a variable for the number of tobacco products individuals smoked
YAS_merge1$tobacco_all <- rowSums(YAS_merge1[,c("t___a", "t___b",
                                                            "t___c", "t___d", 
                                                            "t___e",
                                                "t___f")])

#Creating a yes/no tobacco variable
YAS_merge1 <- YAS_merge1 %>%
  mutate(tobacco_yn= ifelse(tobacco_all != 0, 1, 0))

#Creating a yes/no binge drinking variable
YAS_merge1 <- YAS_merge1 %>%
  mutate(a_binge = ifelse(a_2 == 0, 0, 1))

#Creating a yes/no health insurance variable
YAS_merge1 <- YAS_merge1 %>%
  mutate(ha_yn= ifelse(ha %in% c(11, 12, 13), 0, 1))

#Creating a yes/no variable for d_2
YAS_merge1 <- YAS_merge1 %>%
  mutate(d2_yn= ifelse(d_2 == 0, 0, 1))

#Creating a yes/no variable for d_3
YAS_merge1 <- YAS_merge1 %>%
  mutate(d3_yn= ifelse(d_3 == 0, 0, 1))

#Creating a yes/no variable for m_4
YAS_merge1 <- YAS_merge1 %>%
  mutate(m_4yn= ifelse(m_4 == 0, 0, 1))

#Creating a yes/no variable for mh_4 (Attempted Suicide)
YAS_merge1 <- YAS_merge1 %>%
  mutate(mh4yn= ifelse(mh_4 == 1, 0, 1))


YAS_design <- svydesign(data=YAS_merge1, weights=~wt, id=~1)



```

Subsetting Selected County
```{r}
county <- subset(YAS_merge1, county == 1)

svy.county <- svydesign(ids = ~1, data = county,
                      weights = county$wt)
``` 


### Alcohol Analysis

```{r}
#Current alcohol use [a] - defined as drank alcohol at least one day in the past month; maybe covered under the overall current substance use graph?

#Distribution of Responses by alcohol use [a]
prop_a <- svytable (~a, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

prop_a$varname <- recode(prop_a$a, '0' = "No", '1' = "Yes")


#County Analysis
prop_a.cty <- svytable (~a, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_a.cty$varname <- recode(prop_a$a, '0' = "No", '1' = "Yes")

prop_a$group <- "Statewide"
prop_a.cty$group <- "County"

plot_a <- rbind(prop_a, prop_a.cty)
plot_a = subset(plot_a, select = -c(a))
plot_a$Tobacco <- "Alcohol"
```

In this output table 1 = No and 0 = Yes.

```{r}

#Distribution of Responses by binge drinking [a_2]
prop_a2 <- svytable (~a_2, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

prop_a2$varname <- recode(prop_a2$a_2, '0' = "None", 
                          '1' = "1 day", 
                          '2' = '2 days', 
                          '3' = '3-5 days', 
                          '4' = '6 to 9 days',
                          '5' = '10 or more days')

prop_a2


#County Analysis
prop_a2.cty <- svytable (~a_2, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_a2.cty$varname <- recode(prop_a2$a_2, '0' = "None", 
                          '1' = "1 day", 
                          '2' = '2 days', 
                          '3' = '3-5 days', 
                          '4' = '6 to 9 days',
                          '5' = '10 or more days')
prop_a2$group <- "Statewide"
prop_a2.cty$group <- "County"

plot_a2 <- rbind(prop_a2, prop_a2.cty)

```
```{r}
#Created variable a_binge (binge drinking yes/no)
prop_ab <- svytable (~a_binge, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

prop_ab$varname <- recode(prop_ab$a_binge, '0' = "No", '1' = "Yes")


#County Analysis
prop_ab.cty <- svytable (~a_binge, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_ab.cty$varname <- recode(prop_ab$a_binge,  '0' = "No", '1' = "Yes")

prop_ab$group <- "Statewide"
prop_ab.cty$group <- "County"

plot_ab <- rbind(prop_ab, prop_ab.cty)
```



```{r}
#Distribution of Responses on whether they set drink limits [a_3]
prop_a3 <- svytable (~a_3, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

prop_a3$varname <- recode(prop_a3$a_3, '0' = "No", '1' = "Yes")

prop_a3

#County Analysis
prop_a3.cty <- svytable (~a_3, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_a3.cty$varname <- recode(prop_a3$a_3,  '0' = "No", '1' = "Yes")

prop_a3$group <- "Statewide"
prop_a3.cty$group <- "County"

plot_a3 <- rbind(prop_a3, prop_a3.cty)
```

```{r}
#Distribution of Responses on how often ID was checked when buying alcohol [a_5]
prop_a5 <- svytable (~a_5, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

prop_a5$varname <- recode(prop_a5$a_5, '1' = "Never purchased alcohol", '2' = "Always", '3' = "Very Often", '4' = "Sometimes", '5' = "Rarely", '6' = "Never")

#County Analysis
prop_a5.cty <- svytable (~a_5, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_a5.cty$varname <- recode(prop_a5$a_5,  '1' = "Never purchased alcohol", '2' = "Always", '3' = "Very Often", '4' = "Sometimes", '5' = "Rarely", '6' = "Never")

prop_a5$group <- "Statewide"
prop_a5.cty$group <- "County"

plot_a5 <- rbind(prop_a5, prop_a5.cty)


```

```{r}
#Perception of Harm of binge drinking [a_7]
#Percent reporting no or minimal risk

prop_a7 <- svytable (~a_7, design=YAS_design) %>%
  as.data.frame() %>%
#  filter (a_7 == 2 | a_7 ==1) %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

prop_a7$varname <- recode(prop_a7$a_7, '1' = "No risk", '2' = "Minimal risk", '3' = "Moderate risk", '4' = "High risk")

#County Analysis
prop_a7.cty <- svytable (~a_7, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_a7.cty$varname <- recode(prop_a7.cty$a_7,  '1' = "No risk", '2' = "Minimal risk", '3' = "Moderate risk", '4' = "High risk")

prop_a7$group <- "Statewide"
prop_a7.cty$group <- "County"

plot_a7 <- rbind(prop_a7, prop_a7.cty)
```

### Tobacco Analysis

```{r}
# Analyzing any tobacco use in the last 30 days [created variable - tobacco_yn]
prop_tyn <- svytable (~tobacco_yn, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

prop_tyn$varname <- recode(prop_tyn$tobacco_yn, '1' = "Yes",
                          '0' = "No")
sum(prop_tyn$Freq)
sum(YAS_merge1$t___a)

#County Analysis
prop_tyn.cty <- svytable (~tobacco_yn, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_tyn.cty$varname <- recode(prop_tyn.cty$tobacco_yn, '1' = "Yes",
                          '0' = "No")

prop_tyn$group <- "Statewide"
prop_tyn.cty$group <- "County"

plot_tyn <- rbind(prop_tyn, prop_tyn.cty)




p1a <- ggplot(data=prop_tyn, aes(x = reorder(varname, -Weighted_Prop), 
                              y= Weighted_Prop)) +
    geom_bar(stat = "identity") +
    coord_flip()
p1a + labs(title = "Young adults who used any tobacco products in the last 30 days",
        y = "Weighted Proportion", x = "Number of tobacco users") + scale_y_continuous(labels = scales::percent_format(scale = 100))
```

```{r}
#Distribution of Responses by cigarette use [t___a]
prop_ta <- svytable (~t___a_2, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq),
          Tobacco = "Cigarettes") %>%
  arrange(desc(Weighted_Prop))

prop_ta$varname <- recode(prop_ta$t___a_2, '0' = "No", '100' = "Yes")

#County Analysis
prop_ta.cty <- svytable (~t___a_2, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_ta.cty$varname <- recode(prop_ta.cty$t___a_2, '100' = "Yes",
                          '0' = "No")

prop_ta$group <- "Statewide"
prop_ta.cty$group <- "County"
prop_ta.cty$Tobacco <- "Cigarettes"

plot_ta <- rbind(prop_ta, prop_ta.cty)
plot_ta = subset(plot_ta, select = -c(t___a_2))

p1b <- ggplot(data=prop_ta, aes(x = reorder(varname, -Weighted_Prop), 
                              y= Weighted_Prop)) +
    geom_bar(stat = "identity") +
    coord_flip()
p1b + labs(title = "Young adults who used any cigarettes in the last 30 days",
        y = "Percentage", x = "Cigarette user") + scale_y_continuous(labels = scales::percent_format(scale = 100))
```

```{r}
#Distribution of Responses by cigars/cigarillos use [t___b]
prop_tb <- svytable (~t___b, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq),
          Tobacco = "Cigars") %>%
  arrange(desc(Weighted_Prop))

prop_tb$varname <- recode(prop_tb$t___b, '0' = "No", '1' = "Yes")

#County Analysis
prop_tb.cty <- svytable (~t___b, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_tb.cty$varname <- recode(prop_tb.cty$t___b, '1' = "Yes",
                          '0' = "No")

prop_tb$group <- "Statewide"
prop_tb.cty$group <- "County"
prop_tb.cty$Tobacco <- "Cigars"

plot_tb <- rbind(prop_tb, prop_tb.cty)
plot_tb = subset(plot_tb, select = -c(t___b))


p1c <- ggplot(data=prop_tb, aes(x = reorder(varname, -Weighted_Prop), 
                              y= Weighted_Prop)) +
    geom_bar(stat = "identity") +
    coord_flip()
p1c + labs(title = "Young adults who used any Cigar/Cigarillo in the last 30 days",
        y = "Percentage", x = "Cigar/Cigarillo user") + scale_y_continuous(labels = scales::percent_format(scale = 100))
```

```{r}
#Distribution of Responses by hookah use [t___c]
prop_tc <- svytable (~t___c, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq),
          Tobacco = "Hookah") %>%
  arrange(desc(Weighted_Prop))

prop_tc$varname <- recode(prop_tc$t___c, '0' = "No", '1' = "Yes")

#County Analysis
prop_tc.cty <- svytable (~t___c, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_tc.cty$varname <- recode(prop_tc.cty$t___c, '1' = "Yes",
                          '0' = "No")

prop_tc$group <- "Statewide"
prop_tc.cty$group <- "County"
prop_tc.cty$Tobacco <- "Hookah"

plot_tc <- rbind(prop_tc, prop_tc.cty)
plot_tc = subset(plot_tc, select = -c(t___c))


p1d <- ggplot(data=prop_tc, aes(x = reorder(varname, -Weighted_Prop), 
                              y= Weighted_Prop)) +
    geom_bar(stat = "identity") +
    coord_flip()
p1d + labs(title = "Young adults who used any hookah in the last 30 days",
        y = "Percentage", x = "Hookah use") + scale_y_continuous(labels = scales::percent_format(scale = 100))
```

```{r}
#Distribution of Responses by Smokeless tobacco use (chew, snus, snuff) [t___d]
prop_td <- svytable (~t___d, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq),
          Tobacco = "Smokeless Tobacco") %>%
  arrange(desc(Weighted_Prop))

prop_td$varname <- recode(prop_td$t___d, '0' = "No", '1' = "Yes")

#County Analysis
prop_td.cty <- svytable (~t___d, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_td.cty$varname <- recode(prop_td.cty$t___d, '1' = "Yes",
                          '0' = "No")

prop_td$group <- "Statewide"
prop_td.cty$group <- "County"
prop_td.cty$Tobacco <- "Smokeless Tobacco"

plot_td <- rbind(prop_td, prop_td.cty)
plot_td = subset(plot_td, select = -c(t___d))


p1e <- ggplot(data=prop_td, aes(x = reorder(varname, -Weighted_Prop), 
                              y= Weighted_Prop)) +
    geom_bar(stat = "identity") +
    coord_flip()
p1e + labs(title = "Young adults who used any smokeless tobacco in the last 30 days",
        y = "Percentage", x = "Smokeless Tobacco use") + scale_y_continuous(labels = scales::percent_format(scale = 100))
```

```{r}
#Distribution of Responses by vaping use [t___e]
prop_te <- svytable (~t___e, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq),
          Tobacco = "Vaping") %>%
  arrange(desc(Weighted_Prop))

prop_te$varname <- recode(prop_te$t___e, '0' = "No", '1' = "Yes")

#County Analysis
prop_te.cty <- svytable (~t___e, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_te.cty$varname <- recode(prop_te.cty$t___e, '1' = "Yes",
                          '0' = "No")

prop_te$group <- "Statewide"
prop_te.cty$group <- "County"
prop_te.cty$Tobacco <- "Vaping"

plot_te <- rbind(prop_te, prop_te.cty)
plot_te = subset(plot_te, select = -c(t___e))


p1f <- ggplot(data=prop_te, aes(x = reorder(varname, -Weighted_Prop), 
                              y= Weighted_Prop)) +
    geom_bar(stat = "identity") +
    coord_flip()
p1f + labs(title = "Young adults who used any e-Cigarettes/Vapes in the last 30 days",
        y = "Percentage", x = "e-CigaretteVaping use") + scale_y_continuous(labels = scales::percent_format(scale = 100))
```

```{r}
#Distribution of Responses by Other tobacco product use [t___f]
prop_tf <- svytable (~t___f, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq),
          Tobacco = "Other") %>%
  arrange(desc(Weighted_Prop))

prop_tf$varname <- recode(prop_tf$t___f, '0' = "No", '1' = "Yes")

#County Analysis
prop_tf.cty <- svytable (~t___f, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_tf.cty$varname <- recode(prop_tf.cty$t___f, '1' = "Yes",
                          '0' = "No")

prop_tf$group <- "Statewide"
prop_tf.cty$group <- "County"
prop_tf.cty$Tobacco <- "Other"

plot_tf <- rbind(prop_tf, prop_tf.cty)
plot_tf = subset(plot_tf, select = -c(t___f))


```

```{r}
#Distribution of Responses for no tobacco/nicotine use [t___g]
prop_tg <- svytable (~t___g, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq),
          Tobacco = "None") %>%
  arrange(desc(Weighted_Prop))

prop_tg$varname <- recode(prop_tg$t___g, '0' = "No", '1' = "Yes")

#County Analysis
prop_tg.cty <- svytable (~t___g, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_tg.cty$varname <- recode(prop_tg.cty$t___g, '1' = "Yes",
                          '0' = "No")

prop_tg$group <- "Statewide"
prop_tg.cty$group <- "County"
prop_tg.cty$Tobacco <- "None"

plot_tg <- rbind(prop_tg, prop_tg.cty)
plot_tg = subset(plot_tg, select = -c(t___g))

```

```{r}
Tobacco_all <- rbind(plot_ta, plot_tb, plot_tc, plot_td, plot_te, plot_tf, plot_tg) %>%
    filter(varname == "Yes") %>%
     arrange(desc(Weighted_Prop))

p1 <- ggplot(data=Tobacco_all, aes(x = reorder(Tobacco, Weighted_Prop), y= Weighted_Prop)) +
    geom_bar(stat = "identity") +
    coord_flip()
p1 + labs(title = "Types of tobacco products used by young adults",
        y = "Percentage", x = "Tobacco product") + scale_y_continuous(labels = scales::percent_format(scale = 100))

```

[**Question for Melissa about this output!!!**]{.underline}

Do you want to keep "none" on this graph?

#### People who used more than 1 type of Tobacco

```{r}

Wyoming_YAS_2022$tobacco_all <- rowSums(Wyoming_YAS_2022[,c("t___a", "t___b",
                                                            "t___c", "t___d", 
                                                            "t___e", "t___f")])

num_tobacco_products <-  Wyoming_YAS_2022 %>%
  count(tobacco_all)
print(num_tobacco_products)
```

### Marijuana Analysis

```{r}
#Distribution of Responses on marijuana use in past year [m]
prop_m <- svytable (~m, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

prop_m$varname <- recode(prop_m$m, '0' = "No", '1' = "Yes")

prop_m
sum(prop_m$Freq)

#County Analysis
prop_m.cty <- svytable (~m, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_m.cty$varname <- recode(prop_m.cty$m, '1' = "Yes",
                          '0' = "No")

prop_m$group <- "Statewide"
prop_m.cty$group <- "County"

plot_m <- rbind(prop_m, prop_m.cty)
```

```{r}
#Distribution of Responses on marijuana use frequency in past year [m_1]
prop_m1 <- svytable (~m_1, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

prop_m1$varname <- recode(prop_m1$m_1, '1' = "Daily", '2' = "Weekly", 
                          '3' = "Monthly", '4' = "A few times during the year",
                          '5' = "Only once")

#County Analysis
prop_m1.cty <- svytable (~m_1, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_m1.cty$varname <- recode(prop_m1.cty$m_1, '1' = "Daily", '2' = "Weekly", 
                          '3' = "Monthly", '4' = "A few times during the year",
                          '5' = "Only once")

prop_m1$group <- "Statewide"
prop_m1.cty$group <- "County"

plot_m1 <- rbind(prop_m1, prop_m1.cty)
```

```{r}
#Distribution of Responses on driving after marijuana use [m_3]
prop_m3 <- svytable (~m_3, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

prop_m3$varname <- recode(prop_m3$m_3, '0' = "No", '1' = "Yes")

#County Analysis
prop_m3.cty <- svytable (~m_3, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_m3.cty$varname <- recode(prop_m3.cty$m_3, '0' = "No", '1' = "Yes")

prop_m3$group <- "Statewide"
prop_m3.cty$group <- "County"

plot_m3 <- rbind(prop_m3, prop_m3.cty)

p2 <- ggplot(data=prop_m3, aes(x = reorder(varname, -Weighted_Prop), 
                              y= Weighted_Prop)) +
    geom_bar(stat = "identity") +
    coord_flip()
p2 + labs(title = "Proportion of young adults who drove after marijuana use",
        y = "Weighted Proportion", x = "Drove after using marijuana") + scale_y_continuous(labels = scales::percent_format(scale = 100))
```

```{r}
#Distribution of Responses on marijuana use in last 30 days [m_4]
prop_m4 <- svytable (~m_4, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

prop_m4$varname <- recode(prop_m4$m_4, '0' = "None", '1' = "1 day", 
                          '2' = "2 days", '3' = "3-5 days", '4' = "6-9 days",
                          '5' = "10 or more days")

m4_yn <- prop_m4 %>%
  mutate(m4_yn= ifelse(m_4 != 0, "Yes", "No"))

sum(m4_yn$Freq)

#County Analysis
prop_m4.cty <- svytable (~m_4, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_m4.cty$varname <- recode(prop_m4.cty$m_4, '0' = "None", '1' = "1 day", 
                          '2' = "2 days", '3' = "3-5 days", '4' = "6-9 days",
                          '5' = "10 or more days")

prop_m4$group <- "Statewide"
prop_m4.cty$group <- "County"

plot_m4 <- rbind(prop_m4, prop_m4.cty)

p3 <- ggplot(data=m4_yn, aes(x = reorder(m4_yn, -Weighted_Prop), 
                              y= Weighted_Prop)) +
    geom_bar(stat = "identity") +
    coord_flip()
p3 + labs(title = "Proportion of young adults who used marijuana in last 30 days",
        y = "Weighted Proportion", x = "Used marijuana") + scale_y_continuous(labels = scales::percent_format(scale = 100))
```

[**Question for Melissa about this output!!!**]{.underline}

There are 1626 respondents to this question, and the output graph makes it look like 60% of youth have smoked pot in the last 30 days. Even though, really this is just saying Among people who smoked at all in the last year, 60% of those have smoked in the last 30 days. This question was only answered if m=1, and includes 43% of total respondents.

Option do I include those who answered m=0 in the "No" group for this output?

```{r}
#Distribution of Responses on marijuana use in last 30 days [m4_yn]
##Analyzing as a yes/no variable
prop_m4yn <- svytable (~m_4yn, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

prop_m4yn$varname <- recode(prop_m4yn$m_4yn, '0' = "No", '1' = "Yes")



#County Analysis
prop_m4yn.cty <- svytable (~m_4yn, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_m4yn.cty$varname <- recode(prop_m4yn.cty$m_4yn, '0' = "No", '1' = "Yes") 

prop_m4yn$group <- "Statewide"
prop_m4yn.cty$group <- "County"

plot_m4yn <- rbind(prop_m4yn, prop_m4yn.cty)
```




```{r}
#Distribution of Responses on how they obtained marijuana [m_5]
prop_m5 <- svytable (~m_5, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

prop_m5$varname <- recode(prop_m5$m_5, '1' = "From a friend or relative for free",
                          '2' = "Bought from friend or relative",
                          '3' = "Took from friend or relative without asking",
                          '4' = "Bought from drug dealer or other stranger",
                          '5' = "Purchased in another state where retail marijuana is available",
                          '6' = "Get a medical card from a physician to purchase in another state where it is legal",
                          '7' = "Some other way")

#County Analysis
prop_m5.cty <- svytable (~m_5, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_m5.cty$varname <- recode(prop_m5.cty$m_5, '1' = "From a friend or relative for free",
                          '2' = "Bought from friend or relative",
                          '3' = "Took from friend or relative without asking",
                          '4' = "Bought from drug dealer or other stranger",
                          '5' = "Purchased in another state where retail marijuana is available",
                          '6' = "Get a medical card from a physician to purchase in another state where it is legal",
                          '7' = "Some other way")
prop_m5$group <- "Statewide"
prop_m5.cty$group <- "County"

plot_m5 <- rbind(prop_m5, prop_m5.cty)

p4 <- ggplot(data=prop_m5, aes(x = reorder(varname, -Weighted_Prop), 
                              y= Weighted_Prop)) +
    geom_bar(stat = "identity") +
    coord_flip()
p4 + labs(title = "How young adults obtained marijuana",
        y = "Weighted Proportion", x = "How young adults obtained marijuana") + scale_y_continuous(labels = scales::percent_format(scale = 100))
```

```{r}

#Distribution of Responses on perception of marijuana risk [m_7]
prop_m7 <- svytable (~m_7, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

prop_m7$varname <- recode(prop_m7$m_7, '1' = "No risk",
                          '2' = "Minimal risk",
                          '3' = "Moderate risk",
                          '4' = "High risk")

#County Analysis
prop_m7.cty <- svytable (~m_7, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_m7.cty$varname <- recode(prop_m7.cty$m_7,  '1' = "No risk",
                          '2' = "Minimal risk",
                          '3' = "Moderate risk",
                          '4' = "High risk")

prop_m7$group <- "Statewide"
prop_m7.cty$group <- "County"

plot_m7 <- rbind(prop_m7, prop_m7.cty)

p5 <- ggplot(data=prop_m7, aes(x = reorder(varname, Weighted_Prop), 
                              y= Weighted_Prop)) +
    geom_bar(stat = "identity") +
    coord_flip()

p5 + labs(title = "How young adults perceive the potential harm of weekly marijuana use", y = "Weighted Proportion", x = "How young adults obtained marijuana") + scale_y_continuous(labels = scales::percent_format(scale = 100))


p5 <- ggplot(data = plot_m7, aes(x = reorder(varname, Weighted_Prop), y = Weighted_Prop, fill = group)) +
  geom_bar(stat = "identity", position = "dodge") +
  coord_flip() +
  scale_y_continuous(labels = scales::percent_format(scale = 100)) +  # Convert decimals to percentages
  labs(title = "How young adults perceive the potential harm of weekly marijuana use",
       y = "Weighted Proportion",
       x = "How young adults obtained marijuana") +
  theme_minimal()
p5
```

### Opioid Analysis
```{r}
#Ever used kratom? [d]
prop_d <- svytable (~d, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

prop_d$varname <- recode(prop_d$d,  '1' = "Yes",
                          '0' = "No")
sum(prop_d$Freq)

#County Analysis
prop_d.cty <- svytable (~d, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_d.cty$varname <- recode(prop_d.cty$d,  '1' = "Yes",
                          '0' = "No")

prop_d$group <- "Statewide"
prop_d.cty$group <- "County"

plot_d <- rbind(prop_d, prop_d.cty)


```
```{r}
#Ever used kratom? [d]
prop_d1 <- svytable (~d_1, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

prop_d1$varname <- recode(prop_d1$d_1,
                          '1' = "Yes",
                          '0' = "No")
sum(prop_d1$Freq)

#County Analysis
prop_d1.cty <- svytable (~d_1, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_d1.cty$varname <- recode(prop_d1.cty$d_1,  '1' = "Yes",
                          '0' = "No")

prop_d1$group <- "Statewide"
prop_d1.cty$group <- "County"

plot_d1 <- rbind(prop_d1, prop_d1.cty)
```


```{r}
#On how many days did you take prescription drugs to get high in past 30 days? [d_2]
prop_d2 <- svytable (~d_2, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

prop_d2$varname <- recode(prop_d2$d_2, '0' = "None",
                          '1' = "1 day",
                          '2' = "2 days",
                          '3' = "3-5 days",
                          '4' = "6-9 days",
                          '5' = "10 or more days")
sum(prop_d2$Freq)

#County Analysis
prop_d2.cty <- svytable (~d_2, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_d2.cty$varname <- recode(prop_d2.cty$d_2,  '0' = "None",
                          '1' = "1 day",
                          '2' = "2 days",
                          '3' = "3-5 days",
                          '4' = "6-9 days",
                          '5' = "10 or more days")

prop_d2$group <- "Statewide"
prop_d2.cty$group <- "County"

plot_d2 <- rbind(prop_d2, prop_d2.cty)


p6 <- ggplot(data=prop_d2, aes(x = reorder(varname, Weighted_Prop), 
                              y= Weighted_Prop)) +
    geom_bar(stat = "identity") +
    coord_flip()
p6 + labs(title = "How often young adults used prescription drugs to get high in past 30 days",
        y = "Weighted Proportion", x = "Number of days") + scale_y_continuous(labels = scales::percent_format(scale = 100))
```

+++++++ This analysis has the same issue as the marijuana. It presents only the data for the people who used prescription drugs at all within the last year.

```{r}
#Prescription drugs in last 30 days? [d2_yn]
prop_d2yn <- svytable (~d2_yn, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

prop_d2yn$varname <- recode(prop_d2yn$d2_yn,
                          '1' = "Yes",
                          '0' = "No")
sum(prop_d2yn$Freq)

#County Analysis
prop_d2yn.cty <- svytable (~d2_yn, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_d2yn.cty$varname <- recode(prop_d2yn.cty$d2_yn,  '1' = "Yes",
                          '0' = "No")

prop_d2yn$group <- "Statewide"
prop_d2yn.cty$group <- "County"

plot_d2yn <- rbind(prop_d2yn, prop_d2yn.cty)
```



```{r}

#In last 30 days, did you use prescription pain relievers? [d3_yn]
prop_d3yn <- svytable (~d3_yn, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

prop_d3yn$varname <- recode(prop_d3yn$d3_yn,
                          '1' = "Yes",
                          '0' = "No")
sum(prop_d3yn$Freq)

#County Analysis
prop_d3yn.cty <- svytable (~d3_yn, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_d3yn.cty$varname <- recode(prop_d3yn.cty$d3_yn,  '1' = "Yes",
                          '0' = "No")

prop_d3yn$group <- "Statewide"
prop_d3yn.cty$group <- "County"

plot_d3yn <- rbind(prop_d3yn, prop_d3yn.cty)
```

### Suicide/Mental Health

```{r}
#In the past 2 weeks, how often have you felt down, depressed or hopeless? [mh]
prop_mh <- svytable (~mh, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

prop_mh$varname <- recode(prop_mh$mh,  '1' = "Nearly every day",
                          '2' = "More than half days",
                          '3' = "Several days",
                          '4' = "Once or twice",
                          '5' = "Not at all")
sum(prop_mh$Freq)

#County Analysis
prop_mh.cty <- svytable (~mh, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_mh.cty$varname <- recode(prop_mh.cty$mh, '1' = "Nearly every day",
                          '2' = "More than half days",
                          '3' = "Several days",
                          '4' = "Once or twice",
                          '5' = "Not at all")

prop_mh$group <- "Statewide"
prop_mh.cty$group <- "County"

plot_mh <- rbind(prop_mh, prop_mh.cty)


```

```{r}
#Have you received psychological or mental health services in the last 12 months? [mh_1]
prop_mh1 <- svytable (~mh_1, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

prop_mh1$varname <- recode(prop_mh1$mh_1,  '1' = "Yes",
                          '2' = "No",
                          '3' = "Prefer not to answer")
sum(prop_mh1$Freq)

#County Analysis
prop_mh1.cty <- svytable (~mh_1, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_mh1.cty$varname <- recode(prop_mh1.cty$mh_1,  '1' = "Yes",
                          '2' = "No",
                          '3' = "Prefer not to answer")

prop_mh1$group <- "Statewide"
prop_mh1.cty$group <- "County"

plot_mh1 <- rbind(prop_mh1, prop_mh1.cty)

p.mh <- ggplot(data=prop_mh1, aes(x = reorder(varname, Weighted_Prop), 
                              y= Weighted_Prop)) +
    geom_bar(stat = "identity") +
    coord_flip()
p.mh + labs(title = "Whether young adults would consider seeking help from a mental health professional in the future",
        y = "Weighted Proportion", x = "Response" ) + scale_y_continuous(labels = scales::percent_format(scale = 100))
```



```{r}

#Would you consider seeking help from a mental health professional in the future? [mh_2]
prop_mh2 <- svytable (~mh_2, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

prop_mh2$varname <- recode(prop_mh2$mh_2,  '1' = "Yes",
                          '2' = "No",
                          '3' = "Unsure")
sum(prop_mh2$Freq)

#County Analysis
prop_mh2.cty <- svytable (~mh_2, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_mh2.cty$varname <- recode(prop_mh2.cty$mh_2,  '1' = "Yes",
                          '2' = "No",
                          '3' = "Unsure")

prop_mh2$group <- "Statewide"
prop_mh2.cty$group <- "County"

plot_mh2 <- rbind(prop_mh2, prop_mh2.cty)

p9 <- ggplot(data=prop_mh2, aes(x = reorder(varname, Weighted_Prop), 
                              y= Weighted_Prop)) +
    geom_bar(stat = "identity") +
    coord_flip()
p9 + labs(title = "Whether young adults would consider seeking help from a mental health professional in the future",
        y = "Weighted Proportion", x = "Response" ) + scale_y_continuous(labels = scales::percent_format(scale = 100))
```

```{r}

#Have you seriously considered suicide in the past 12 months? [mh_3]
prop_mh3 <- svytable (~mh_3, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

prop_mh3$varname <- recode(prop_mh3$mh_3,  '1' = "Yes",
                          '2' = "No")
sum(prop_mh3$Freq)

#County Analysis
prop_mh3.cty <- svytable (~mh_3, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_mh3.cty$varname <- recode(prop_mh3.cty$mh_3,  '1' = "Yes",
                          '2' = "No")

prop_mh3$group <- "Statewide"
prop_mh3.cty$group <- "County"

plot_mh3 <- rbind(prop_mh3, prop_mh3.cty)

p10 <- ggplot(data=prop_mh3, aes(x = reorder(varname, Weighted_Prop), 
                              y= Weighted_Prop)) +
    geom_bar(stat = "identity") +
    coord_flip()
p10 + labs(title = "Whether young adults have seriously considered suicide in the past year",
        y = "Weighted Proportion", x = "Response" ) + scale_y_continuous(labels = scales::percent_format(scale = 100))
```

```{r}
#How many times did you attempt suicide in the past 12 months? [mh_4]
prop_mh4 <- svytable (~mh_4, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

prop_mh4$varname <- recode(prop_mh4$mh_4,  '1' = "None",
                          '2' = "Once",
                          '3' = "Twice",
                          '4' = "Three or more times")
sum(prop_mh4$Freq)

#County Analysis
prop_mh4.cty <- svytable (~mh_4, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_mh4.cty$varname <- recode(prop_mh4.cty$mh_4,  '1' = "None",
                          '2' = "Once",
                          '3' = "Twice",
                          '4' = "Three or more times")

prop_mh4$group <- "Statewide"
prop_mh4.cty$group <- "County"

plot_mh4 <- rbind(prop_mh4, prop_mh4.cty)

p11 <- ggplot(data=prop_mh4, aes(x = reorder(varname, Weighted_Prop), 
                              y= Weighted_Prop)) +
    geom_bar(stat = "identity") +
    coord_flip()
p11 + labs(title = "How many times young adults have attempted suicide in the past year",
        y = "Weighted Proportion", x = "Response" ) + scale_y_continuous(labels = scales::percent_format(scale = 100))
```

```{r}
#[mh_4] Attempted Suicide (yes/No)
prop_mh4yn <- svytable (~mh4yn, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

prop_mh4yn$varname <- recode(prop_mh4yn$mh4yn,  '1' = "Yes",
                          '0' = "No")
sum(prop_mh4yn$Freq)

#County Analysis
prop_mh4yn.cty <- svytable (~mh4yn, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_mh4yn.cty$varname <- recode(prop_mh4yn.cty$mh4yn,  '1' = "Yes",
                          '0' = "No")

prop_mh4yn$group <- "Statewide"
prop_mh4yn.cty$group <- "County"

plot_mh4yn <- rbind(prop_mh4yn, prop_mh4yn.cty)
```


### Firearms

```{r}
#Are any firearms now kept in or around your home? [fire]
prop_fire <- svytable (~fire, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

prop_fire$varname <- recode(prop_fire$fire,  '1' = "Yes",
                          '2' = "No",
                          '3' = "Don't know/Not sure",
                          '4' = "Prefer not to answer")
sum(prop_fire$Freq)


#County Analysis
prop_fire.cty <- svytable (~fire, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_fire.cty$varname <- recode(prop_fire.cty$fire,  '1' = "Yes",
                          '2' = "No",
                          '3' = "Don't know/Not sure",
                          '4' = "Prefer not to answer")

prop_fire$group <- "Statewide"
prop_fire.cty$group <- "County"

plot_fire <- rbind(prop_fire, prop_fire.cty)

p12 <- ggplot(data=prop_fire, aes(x = reorder(varname, Weighted_Prop), 
                              y= Weighted_Prop)) +
    geom_bar(stat = "identity") +
    coord_flip()
p12 + labs(title = "Whether young adults have a firearm in their home",
        y = "Weighted Proportion", x = "Response" ) + scale_y_continuous(labels = scales::percent_format(scale = 100))
```

```{r}
#Are any of these firearms loaded? [fire_1]
prop_fire1 <- svytable (~fire_1, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

prop_fire1$varname <- recode(prop_fire1$fire_1,  '1' = "Yes",
                          '2' = "No",
                          '3' = "Don't know/Not sure")
sum(prop_fire1$Freq)


#County Analysis
prop_fire1.cty <- svytable (~fire_1, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_fire1.cty$varname <- recode(prop_fire1.cty$fire_1,  '1' = "Yes",
                          '2' = "No",
                          '3' = "Don't know/Not sure",
                          '4' = "Prefer not to answer")

prop_fire1$group <- "Statewide"
prop_fire1.cty$group <- "County"

plot_fire1 <- rbind(prop_fire1, prop_fire1.cty)

```

```{r}
#Whether loaded firearms are unlocked in the home? [fire_2]
prop_fire2 <- svytable (~fire_2, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

prop_fire2$varname <- recode(prop_fire2$fire_2,  '1' = "Yes",
                          '2' = "No")
sum(prop_fire2$Freq)

#County Analysis
prop_fire2.cty <- svytable (~fire_2, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_fire2.cty$varname <- recode(prop_fire2.cty$fire_2, '1' = "Yes",
                          '2' = "No")

prop_fire2$group <- "Statewide"
prop_fire2.cty$group <- "County"

plot_fire2 <- rbind(prop_fire2, prop_fire2.cty)

```

### Shared Protective/Risk Factors
####Insurance

```{r}
prop_ha <- svytable (~ha, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

prop_ha$varname <- recode(prop_ha$ha,  '1' = "Employer-sponsored plan",
                          '2' = "Private non-governmental plan",
                          '3' = "Medicare",
                          '4' = "Medigap",
                          '5' = "Medicaid",
                          '6' = "Children's Health Insurance Program (CHIP)",
                          '7' = "Military",
                          '8' = "IHS",
                          '9' = "State sponsored health plan",
                          '10' = "Other government program",
                          '11' = "No coverage of any type",
                          '12' = "Don't know/not sure",
                          '13' = "Prefer not to answer")
sum(prop_ha$Freq)

#County Analysis
prop_ha.cty <- svytable (~ha, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_ha.cty$varname <- recode(prop_ha.cty$ha, '1' = "Employer-sponsored plan",
                          '2' = "Private non-governmental plan",
                          '3' = "Medicare",
                          '4' = "Medigap",
                          '5' = "Medicaid",
                          '6' = "Children's Health Insurance Program (CHIP)",
                          '7' = "Military",
                          '8' = "IHS",
                          '9' = "State sponsored health plan",
                          '10' = "Other government program",
                          '11' = "No coverage of any type",
                          '12' = "Don't know/not sure",
                          '13' = "Prefer not to answer")

prop_ha$group <- "Statewide"
prop_ha.cty$group <- "County"

plot_ha <- rbind(prop_ha, prop_ha.cty)
```
Insurance yes/no
```{r}
prop_hayn <- svytable (~ha_yn, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

prop_hayn$varname <- recode(prop_hayn$ha_yn,  '1' = "Yes",
                          '0' = "No")
                          

#County Analysis
prop_hayn.cty <- svytable (~ha_yn, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_hayn.cty$varname <- recode(prop_hayn.cty$ha_yn, '1' = "Yes",
                          '0' = "No")

prop_hayn$group <- "Statewide"
prop_hayn.cty$group <- "County"

plot_hayn <- rbind(prop_hayn, prop_hayn.cty)
plot_hayn$Weighted_Prop <- plot_hayn$Weighted_Prop*100
```
#### Seatbelts
How often do you wear a seat belt while driving?
```{r}
prop_mv <- svytable (~mv, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

prop_mv$varname <- recode(prop_mv$mv,  '1' = "Never",
                          '2' = "Rarely",
                          '3' = "Sometimes",
                          '4' = "Most of the time",
                          '5' = "Always")
                          

#County Analysis
prop_mv.cty <- svytable (~mv, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_mv.cty$varname <- recode(prop_mv.cty$mv,  '1' = "Never",
                          '2' = "Rarely",
                          '3' = "Sometimes",
                          '4' = "Most of the time",
                          '5' = "Always")

prop_mv$group <- "Statewide"
prop_mv.cty$group <- "County"

plot_mv <- rbind(prop_mv, prop_mv.cty)
```

During the past 30 days, on how many days did you text or e-mail while driving a car or other vehicle?
```{r}
prop_mv1 <- svytable (~mv_1, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

prop_mv1$varname <- recode(prop_mv1$mv_1,  '1' = "Did not drive",
                          '2' = "0 days",
                          '3' = "1 or 2 days",
                          '4' = "3-5 days",
                          '5' = "6-9 days",
                          '6' = "10-19 days",
                          '7' = "20-29 days",
                          '8' = "All 30 days")
                          

#County Analysis
prop_mv1.cty <- svytable (~mv_1, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_mv1.cty$varname <- recode(prop_mv1.cty$mv_1,  '1' = "Did not drive",
                          '2' = "0 days",
                          '3' = "1 or 2 days",
                          '4' = "3-5 days",
                          '5' = "6-9 days",
                          '6' = "10-19 days",
                          '7' = "20-29 days",
                          '8' = "All 30 days")

prop_mv1$group <- "Statewide"
prop_mv1.cty$group <- "County"

plot_mv1 <- rbind(prop_mv1, prop_mv1.cty)
```

###Demographics
####Sex at Birth
```{r}
#Sex at Birth
prop_demo <- svytable (~demo, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

prop_demo$varname <- recode(prop_demo$demo, '1' = "Male", 
                          '2' = 'Female', 
                          '3' = 'Intersex')


#County Analysis
prop_demo.cty <- svytable (~demo, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_demo.cty$varname <- recode(prop_demo.cty$demo, '1' = "Male", 
                          '2' = 'Female', 
                          '3' = 'Intersex')

prop_demo$group <- "Statewide"
prop_demo.cty$group <- "County"

plot_demo <- rbind(prop_demo, prop_demo.cty)
```

####Race
```{r}
#White Race
prop_demo2a <- svytable (~demo_2___a, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq),
          race = "White") %>%
  arrange(desc(Weighted_Prop))

prop_demo2a$varname <- recode(prop_demo2a$demo_2___a, '1' = "Yes", 
                        '0' = 'No')


#County Analysis
prop_demo2a.cty <- svytable (~demo_2___a, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_demo2a.cty$varname <- recode(prop_demo2a.cty$demo_2___a, '1' = "Yes", 
                        '0' = 'No')

prop_demo2a$group <- "Statewide"
prop_demo2a.cty$group <- "County"
prop_demo2a.cty$race <- "White"

plot_demo2a <- rbind(prop_demo2a, prop_demo2a.cty)
plot_demo2a = subset(plot_demo2a, select = -c(demo_2___a))

```

```{r}
#Black or African American Race
prop_demo2b <- svytable (~demo_2___b, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq),
          race = "Black or African American") %>%
  arrange(desc(Weighted_Prop))

prop_demo2b$varname <- recode(prop_demo2b$demo_2___b, '1' = "Yes", 
                        '0' = 'No')


#County Analysis
prop_demo2b.cty <- svytable (~demo_2___b, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_demo2b.cty$varname <- recode(prop_demo2b.cty$demo_2___b, '1' = "Yes", 
                        '0' = 'No')

prop_demo2b$group <- "Statewide"
prop_demo2b.cty$group <- "County"
prop_demo2b.cty$race <- "Black or African American"

plot_demo2b <- rbind(prop_demo2b, prop_demo2b.cty)
plot_demo2b = subset(plot_demo2b, select = -c(demo_2___b))
```

```{r}
#Asian Race
prop_demo2c <- svytable (~demo_2___c, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq),
          race = "Asian") %>%
  arrange(desc(Weighted_Prop))

prop_demo2c$varname <- recode(prop_demo2c$demo_2___c, '1' = "Yes", 
                        '0' = 'No')


#County Analysis
prop_demo2c.cty <- svytable (~demo_2___c, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_demo2c.cty$varname <- recode(prop_demo2c.cty$demo_2___c, '1' = "Yes", 
                        '0' = 'No')

prop_demo2c$group <- "Statewide"
prop_demo2c.cty$group <- "County"
prop_demo2c.cty$race <- "Asian"

plot_demo2c <- rbind(prop_demo2c, prop_demo2c.cty)
plot_demo2c = subset(plot_demo2c, select = -c(demo_2___c))
```

```{r}
#Native Hawaiian or other Pacific Islander Race
prop_demo2d <- svytable (~demo_2___d, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq),
          race = "NH/PI") %>%
  arrange(desc(Weighted_Prop))

prop_demo2d$varname <- recode(prop_demo2d$demo_2___d, '1' = "Yes", 
                        '0' = 'No')


#County Analysis
prop_demo2d.cty <- svytable (~demo_2___d, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_demo2d.cty$varname <- recode(prop_demo2d.cty$demo_2___d, '1' = "Yes", 
                        '0' = 'No')

prop_demo2d$group <- "Statewide"
prop_demo2d.cty$group <- "County"
prop_demo2d.cty$race <- "NH/PI"

plot_demo2d <- rbind(prop_demo2d, prop_demo2d.cty)
plot_demo2d = subset(plot_demo2d, select = -c(demo_2___d))
```

```{r}
#American Indian or Alaskan Native
prop_demo2e <- svytable (~demo_2___e, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq),
          race = "AI/AN") %>%
  arrange(desc(Weighted_Prop))

prop_demo2e$varname <- recode(prop_demo2e$demo_2___e, '1' = "Yes", 
                        '0' = 'No')


#County Analysis
prop_demo2e.cty <- svytable (~demo_2___e, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_demo2e.cty$varname <- recode(prop_demo2e.cty$demo_2___e, '1' = "Yes", 
                        '0' = 'No')

prop_demo2e$group <- "Statewide"
prop_demo2e.cty$group <- "County"
prop_demo2e.cty$race <- "AI/AN"

plot_demo2e <- rbind(prop_demo2e, prop_demo2e.cty)
plot_demo2e = subset(plot_demo2e, select = -c(demo_2___e))
```

```{r}
#Bi-racial or Multi-racial
prop_demo2f <- svytable (~demo_2___f, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq),
          race = "Bi-racial or Multi-racial") %>%
  arrange(desc(Weighted_Prop))

prop_demo2f$varname <- recode(prop_demo2f$demo_2___f, '1' = "Yes", 
                        '0' = 'No')


#County Analysis
prop_demo2f.cty <- svytable (~demo_2___f, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_demo2f.cty$varname <- recode(prop_demo2f.cty$demo_2___f, '1' = "Yes", 
                        '0' = 'No')

prop_demo2f$group <- "Statewide"
prop_demo2f.cty$group <- "County"
prop_demo2f.cty$race <- "Bi-racial or Multi-racial"

plot_demo2f <- rbind(prop_demo2f, prop_demo2f.cty)
plot_demo2f = subset(plot_demo2f, select = -c(demo_2___f))
```

```{r}
#Hispanic, Latinx, or Spanish Origin
prop_demo2g <- svytable (~demo_2___g, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq),
          race = "Hispanic") %>%
  arrange(desc(Weighted_Prop))

prop_demo2g$varname <- recode(prop_demo2g$demo_2___g, '1' = "Yes", 
                        '0' = 'No')


#County Analysis
prop_demo2g.cty <- svytable (~demo_2___g, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_demo2g.cty$varname <- recode(prop_demo2g.cty$demo_2___g, '1' = "Yes", 
                        '0' = 'No')

prop_demo2g$group <- "Statewide"
prop_demo2g.cty$group <- "County"
prop_demo2g.cty$race <- "Hispanic"

plot_demo2g <- rbind(prop_demo2g, prop_demo2g.cty)
plot_demo2g = subset(plot_demo2g, select = -c(demo_2___g))
```

```{r}
#Other race, ethnicity or origin
prop_demo2h <- svytable (~demo_2___h, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq),
          race = "Other") %>%
  arrange(desc(Weighted_Prop))

prop_demo2h$varname <- recode(prop_demo2h$demo_2___h, '1' = "Yes", 
                        '0' = 'No')


#County Analysis
prop_demo2h.cty <- svytable (~demo_2___h, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_demo2h.cty$varname <- recode(prop_demo2h.cty$demo_2___h, '1' = "Yes", 
                        '0' = 'No')

prop_demo2h$group <- "Statewide"
prop_demo2h.cty$group <- "County"
prop_demo2h.cty$race <- "Other"

plot_demo2h <- rbind(prop_demo2h, prop_demo2h.cty)
plot_demo2h = subset(plot_demo2h, select = -c(demo_2___h))
```

```{r}
#People who are more than 1 race
Wyoming_YAS_2022$race_count <- rowSums(Wyoming_YAS_2022[,c("demo_2___a",
                                                            "demo_2___b",
                                                            "demo_2___c",
                                                            "demo_2___d", 
                                                            "demo_2___e",
                                                            "demo_2___f","demo_2___g", "demo_2___h")])

num_races <-  Wyoming_YAS_2022 %>%
  count(race_count)
print(num_races)
```

```{r}

race_all <- rbind(plot_demo2a, plot_demo2b, plot_demo2c, plot_demo2d, plot_demo2e, plot_demo2f, plot_demo2g, plot_demo2h) %>%
  filter(varname == "Yes") %>%
  group_by(group) %>%
  mutate(rank = rank(-Weighted_Prop)) %>%  # Rank within each group
  arrange(group, rank) %>%  # Sort by group and rank
  select(-rank) 

race_all$Weighted_Prop <- race_all$Weighted_Prop*100
race_all$Weighted_Prop <- round(race_all$Weighted_Prop, digits=1)

p1 <- ggplot(data=Tobacco_all, aes(x = reorder(Tobacco, Weighted_Prop), y= Weighted_Prop)) +
    geom_bar(stat = "identity") +
    coord_flip()
p1 + labs(title = "Types of tobacco products used by young adults",
        y = "Percentage", x = "Tobacco product") + scale_y_continuous(labels = scales::percent_format(scale = 100))
```


####Education
```{r}
#Highest Level of Education Completed
prop_demo4 <- svytable (~demo_4, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))


prop_demo4$varname <- recode(prop_demo4$demo_4, '1' = "Less than a high school degree", 
                        '2' = 'High School graduate/GED',
                        '3' = "Some college, no degree",
                        '4' = "Occ, tech or vocational program",
                        '5' = "College degree",
                        '6' = "Some grad school",
                        '7' = "Graduate or professional degree")
prop_demo4$group <- "Statewide"

#County Analysis
prop_demo4.cty <- svytable (~demo_4, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(demo_4)

#Combining Statewide and County
prop_demo4.cty$varname <- recode(prop_demo4.cty$demo_4,  '1' = "Less than a high school degree", 
                        '2' = 'High School graduate/GED',
                        '3' = "Some college, no degree",
                        '4' = "Occ, tech or vocational program",
                        '5' = "College degree",
                        '6' = "Some grad school",
                        '7' = "Graduate or professional degree")


prop_demo4.cty$group <- "County"
prop_demo4 <- prop_demo4 %>%
  arrange(demo_4)
prop_demo4.cty <- prop_demo4.cty %>%
  arrange(demo_4)

plot_demo4 <- rbind(prop_demo4, prop_demo4.cty)
plot_demo4$Weighted_Prop <- plot_demo4$Weighted_Prop*100
plot_demo4$Weighted_Prop <- round(plot_demo4$Weighted_Prop, digits=1)
```

#### Employment
```{r}
#Employment Status
prop_demo5 <- svytable (~demo_5, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))


prop_demo5$varname <- recode(prop_demo5$demo_5, '1' = "Student", 
                        '2' = 'Employed PT or FT',
                        '3' = "Military",
                        '4' = "Not employed, unable to work",
                        '5' = "Not employed, looking for work",
                        '6' = "Stay-at-home parent")


#County Analysis
prop_demo5.cty <- svytable (~demo_5, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_demo5.cty$varname <- recode(prop_demo5.cty$demo_5,  '1' = "Student", 
                        '2' = 'Employed PT or FT',
                        '3' = "Military",
                        '4' = "Not employed, unable to work",
                        '5' = "Not employed, looking for work",
                        '6' = "Stay-at-home parent")

prop_demo5$group <- "Statewide"
prop_demo5.cty$group <- "County"

plot_demo5 <- rbind(prop_demo5, prop_demo5.cty)
plot_demo5$Weighted_Prop <- plot_demo5$Weighted_Prop*100
plot_demo5$Weighted_Prop <- round(plot_demo5$Weighted_Prop, digits=1)
```

####Hungry
```{r}
#Not enough money for food in last 12 months
prop_demo8 <- svytable (~demo_8, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))


prop_demo8$varname <- recode(prop_demo8$demo_8, '1' = "Yes", 
                        '2' = 'No',
                        '3' = "Don't know")


#County Analysis
prop_demo8.cty <- svytable (~demo_8, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_demo8.cty$varname <- recode(prop_demo8.cty$demo_8, '1' = "Yes", 
                        '2' = 'No',
                        '3' = "Don't know")

prop_demo8$group <- "Statewide"
prop_demo8.cty$group <- "County"

plot_demo8 <- rbind(prop_demo8, prop_demo8.cty)
plot_demo8$Weighted_Prop <- plot_demo8$Weighted_Prop*100
#plot_demo8$Weighted_Prop <- round(plot_demo8$Weighted_Prop, digits=1)
```

#### Living Situation
```{r}
#Living Situation
prop_demo9 <- svytable (~demo_9, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))


prop_demo9$varname <- recode(prop_demo9$demo_9, '1' = "Steady place to live", 
                        '2' = 'Have a place now, worried about losing it in the future',
                        '3' = "No steady place")


#County Analysis
prop_demo9.cty <- svytable (~demo_9, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_demo9.cty$varname <- recode(prop_demo9.cty$demo_9, '1' = "Steady place to live", 
                        '2' = 'Have a place now, worried about losing it in the future',
                        '3' = "No steady place")

prop_demo9$group <- "Statewide"
prop_demo9.cty$group <- "County"

plot_demo9 <- rbind(prop_demo9, prop_demo9.cty)
plot_demo9$Weighted_Prop <- plot_demo9$Weighted_Prop*100
plot_demo9$Weighted_Prop <- round(plot_demo9$Weighted_Prop, digits=1)
```

####Language
```{r}
#Speak a language other than English at home
prop_demo3 <- svytable (~demo_3, design=YAS_design) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))


prop_demo3$varname <- recode(prop_demo3$demo_3, '1' = "Yes", 
                        '2' = 'No')


#County Analysis
prop_demo3.cty <- svytable (~demo_3, design=svy.county) %>%
  as.data.frame() %>%
  mutate( Weighted_Prop = Freq / sum(Freq)) %>%
  arrange(desc(Weighted_Prop))

#Combining Statewide and County
prop_demo3.cty$varname <- recode(prop_demo3.cty$demo_3, '1' = "Yes", 
                        '2' = 'No')

prop_demo3$group <- "Statewide"
prop_demo3.cty$group <- "County"

plot_demo3 <- rbind(prop_demo3, prop_demo3.cty)
plot_demo3$Weighted_Prop <- plot_demo3$Weighted_Prop*100
#plot_demo8$Weighted_Prop <- round(plot_demo8$Weighted_Prop, digits=1)
```

### Crosstabs

```{r}
#Comparing 2 variables - Depression by Alcohol Use. (Survey-Weighted Contingency Tables)
svytable(~mh, design = YAS_design)
svytable(~mh, design = svy.county)




tab_mh_a <-svytable(~mh + a, design = YAS_design)
tab_mh_a <- as.data.frame(tab_mh_a)
# Create a combined category for "Nearly every day" and "More than half days"
tab_mh_a2 <- tab_mh_a %>%
  mutate(a = factor(a, levels = c(0, 1), labels = c("No", "Yes"))) %>%
  mutate(varname = recode(mh, 
                          '1' = "Nearly every day", 
                          '2' = "More than half days", 
                          '3' = "Several days", 
                          '4' = "Once or twice", 
                          '5' = "Not at all")) %>%
  filter(varname %in% c("Nearly every day", "More than half days")) %>%
  mutate(varname = "Frequent Depression") %>%
  group_by(varname, a) %>%
  summarise(Freq = sum(Freq), .groups = 'drop') %>%
  mutate(Percent = Freq / sum(Freq) * 100)

tab_mh_a2$substance <- "Alcohol" 

####County Analysis
tab_mh_a.cty <-svytable(~mh + a, design = svy.county)
tab_mh_a.cty <- as.data.frame(tab_mh_a.cty)
# Create a combined category for "Nearly every day" and "More than half days"
tab_mh_a2.cty <- tab_mh_a.cty %>%
  mutate(a = factor(a, levels = c(0, 1), labels = c("No", "Yes"))) %>%
  mutate(varname = recode(mh, 
                          '1' = "Nearly every day", 
                          '2' = "More than half days", 
                          '3' = "Several days", 
                          '4' = "Once or twice", 
                          '5' = "Not at all")) %>%
  filter(varname %in% c("Nearly every day", "More than half days")) %>%
  mutate(varname = "Frequent Depression") %>%
  group_by(varname, a) %>%
 summarise(Freq = sum(Freq)) %>%
  mutate(Percent = Freq / sum(Freq) * 100)

tab_mh_a2.cty$substance <- "Alcohol" 
tab_mh_a2.cty <- tab_mh_a2.cty %>%
  dplyr::rename(yesno = a)
```

Comparing 2 variables - Depression by Tobacco Use. (Survey-Weighted Contingency Tables) svytable(\~mh, design = YAS_design)

```{r}


tab_mh_t <-svytable(~mh + tobacco_yn, design = YAS_design) 
tab_mh_t <- as.data.frame(tab_mh_t)
tab_mh_ta <- tab_mh_t %>%
  mutate(tobacco_yn = factor(tobacco_yn, levels = c(0, 1), labels = c("No", "Yes")))

tab_mh_ta$varname <- recode(tab_mh_t$mh, '1' = "Nearly every day", '2' = "More than half days", '3' = "Several days", '4' = "Once or twice", '5' = "Not at all")

# Create a combined category for "Nearly every day" and "More than half days"
tab_mh_ta <- tab_mh_t %>%
  mutate(tobacco_yn = factor(tobacco_yn, levels = c(0, 1), labels = c("No", "Yes"))) %>%
  mutate(varname = recode(mh, 
                          '1' = "Nearly every day", 
                          '2' = "More than half days", 
                          '3' = "Several days", 
                          '4' = "Once or twice", 
                          '5' = "Not at all")) %>%
  filter(varname %in% c("Nearly every day", "More than half days")) %>%
  mutate(varname = "Frequent Depression") %>%
  group_by(varname, tobacco_yn) %>%
  summarise(Freq = sum(Freq), .groups = 'drop') %>%
  mutate(Percent = Freq / sum(Freq) * 100)

tab_mh_ta$substance <- "Tobacco" 

##### County
tab_mh_t.cty <-svytable(~mh + tobacco_yn, design = svy.county) 
tab_mh_t.cty <- as.data.frame(tab_mh_t.cty)
tab_mh_ta.cty <- tab_mh_t %>%
  mutate(tobacco_yn = factor(tobacco_yn, levels = c(0, 1), labels = c("No", "Yes")))

tab_mh_ta.cty$varname <- recode(tab_mh_t.cty$mh, '1' = "Nearly every day", '2' = "More than half days", '3' = "Several days", '4' = "Once or twice", '5' = "Not at all")

# Create a combined category for "Nearly every day" and "More than half days"
tab_mh_ta.cty <- tab_mh_t.cty %>%
  mutate(tobacco_yn = factor(tobacco_yn, levels = c(0, 1), labels = c("No", "Yes"))) %>%
  mutate(varname = recode(mh, 
                          '1' = "Nearly every day", 
                          '2' = "More than half days", 
                          '3' = "Several days", 
                          '4' = "Once or twice", 
                          '5' = "Not at all")) %>%
  filter(varname %in% c("Nearly every day", "More than half days")) %>%
  mutate(varname = "Frequent Depression") %>%
  group_by(varname, tobacco_yn) %>%
  summarise(
    Freq = sum(Freq), 
    .groups = 'drop'
    ) %>%
  mutate(Percent = Freq / sum(Freq) * 100)

tab_mh_ta.cty$substance <- "Tobacco" 
tab_mh_ta.cty <- tab_mh_ta.cty %>%
  dplyr::rename(yesno = tobacco_yn)

```

```{r}
#Comparing 2 variables - Depression by Marijuana Use. (Survey-Weighted Contingency Tables)
svytable(~mh, design = YAS_design)

tab_mh_m <-svytable(~mh + m, design = YAS_design)
tab_mh_m <- as.data.frame(tab_mh_m)
# Create a combined category for "Nearly every day" and "More than half days"
tab_mh_m2 <- tab_mh_m %>%
  mutate(m = factor(m, levels = c(0, 1), labels = c("No", "Yes"))) %>%
  mutate(varname = recode(mh, 
                          '1' = "Nearly every day", 
                          '2' = "More than half days", 
                          '3' = "Several days", 
                          '4' = "Once or twice", 
                          '5' = "Not at all")) %>%
  filter(varname %in% c("Nearly every day", "More than half days")) %>%
  mutate(varname = "Frequent Depression") %>%
  group_by(varname, m) %>%
  summarise(Freq = sum(Freq), .groups = 'drop') %>%
  mutate(Percent = Freq / sum(Freq) * 100)

tab_mh_m2$substance <- "Marijuana" 

####County analysis
tab_mh_m.cty <-svytable(~mh + m, design = svy.county)
tab_mh_m.cty <- as.data.frame(tab_mh_m.cty)
# Create a combined category for "Nearly every day" and "More than half days"
tab_mh_m2.cty <- tab_mh_m.cty %>%
  mutate(m = factor(m, levels = c(0, 1), labels = c("No", "Yes"))) %>%
  mutate(varname = recode(mh, 
                          '1' = "Nearly every day", 
                          '2' = "More than half days", 
                          '3' = "Several days", 
                          '4' = "Once or twice", 
                          '5' = "Not at all")) %>%
  filter(varname %in% c("Nearly every day", "More than half days")) %>%
  mutate(varname = "Frequent Depression") %>%
  group_by(varname, m) %>%
  summarise(Freq = sum(Freq), .groups = 'drop') %>%
  mutate(Percent = Freq / sum(Freq) * 100)

tab_mh_m2.cty$substance <- "Marijuana" 
tab_mh_m2.cty <- tab_mh_m2.cty %>%
  rename(yesno = m)

```


```{r}
#Comparing 2 variables - Depression by Rx usage to get high. (Survey-Weighted Contingency Tables)
svytable(~mh, design = YAS_design)

tab_mh_d1 <-svytable(~mh + d_1, design = YAS_design)
tab_mh_d1 <- as.data.frame(tab_mh_d1)
# Create a combined category for "Nearly every day" and "More than half days"
tab_mh_d1a <- tab_mh_d1 %>%
  mutate(d_1 = factor(d_1, levels = c(0, 1), labels = c("No", "Yes"))) %>%
  mutate(varname = recode(mh, 
                          '1' = "Nearly every day", 
                          '2' = "More than half days", 
                          '3' = "Several days", 
                          '4' = "Once or twice", 
                          '5' = "Not at all")) %>%
  filter(varname %in% c("Nearly every day", "More than half days")) %>%
  mutate(varname = "Frequent Depression") %>%
  group_by(varname, d_1) %>%
  summarise(Freq = sum(Freq), .groups = 'drop') %>%
  mutate(Percent = Freq / sum(Freq) * 100)
tab_mh_d1a$substance <- "Prescription Drugs"  


####County analysis
tab_mh_d1.cty <-svytable(~mh + d_1, design = svy.county)
tab_mh_d1.cty <- as.data.frame(tab_mh_d1.cty)
# Create a combined category for "Nearly every day" and "More than half days"
tab_mh_d1a.cty <- tab_mh_d1.cty %>%
  mutate(d_1 = factor(d_1, levels = c(0, 1), labels = c("No", "Yes"))) %>%
  mutate(varname = recode(mh, 
                          '1' = "Nearly every day", 
                          '2' = "More than half days", 
                          '3' = "Several days", 
                          '4' = "Once or twice", 
                          '5' = "Not at all")) %>%
  filter(varname %in% c("Nearly every day", "More than half days")) %>%
  mutate(varname = "Frequent Depression") %>%
  group_by(varname, d_1) %>%
  summarise(Freq = sum(Freq), .groups = 'drop') %>%
  mutate(Percent = Freq / sum(Freq) * 100)
tab_mh_d1a.cty$substance <- "Prescription Drugs"  
tab_mh_d1a.cty <- tab_mh_d1a.cty %>%
  rename(yesno = d_1)
```
  
  


```{r}
##Master crosstab table
tab_mh_a2 <- tab_mh_a2 %>%
  rename(yesno = a)

tab_mh_ta <- tab_mh_ta %>%
  rename(yesno = tobacco_yn)

tab_mh_m2 <- tab_mh_m2 %>%
  rename(yesno = m)

tab_mh_d1a <- tab_mh_d1a %>%
  rename(yesno = d_1)


crosstabs <- rbind(tab_mh_a2, tab_mh_ta, tab_mh_m2, tab_mh_d1a)
crosstabs$group <- "Statewide"

crosstabs.cty <- rbind(tab_mh_a2.cty, tab_mh_ta.cty, tab_mh_m2.cty, tab_mh_d1a.cty)
crosstabs.cty$group <- "County"

crosstabs.all <- rbind(crosstabs, crosstabs.cty)
crosstabs.all$Percent <- round(crosstabs.all$Percent)
```



### Sample Method from MMWR

Outlined method for survey analysis from this site: <https://zatumcorp.com/wp-content/uploads/2019/07/Data-analyses-R-manual-NYTS.pdf>

```{r}
### Crosstab MasterTable

```
